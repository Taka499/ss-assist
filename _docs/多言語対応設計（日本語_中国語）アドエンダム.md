# 多言語対応設計（日本語/中国語）アドエンダム

> 目的：既存の「日本語入力→自動ID生成（A案）」を保ちつつ、\*\*中国語（簡体/繁体）\*\*を後から安全に追加できるようにする。

---

## 1. 多言語の基本方針

- すべての内部判定は **ID（英数字）** で行う（既存仕様を踏襲）。
- 表示テキストは **言語辞書**から取得。辞書は「カテゴリごと」「リソース種別ごと」に分離。
- 言語は `ja`（日本語）、`zh-Hans`（簡体字）、`zh-Hant`（繁体字）をサポート。将来 `en` 等を追加可能。
- Fallback：`active → ja → id`（順に見て最初に見つかった文字列を使う）。

---

## 2. データ構造（配信用 JSON）

### 2.1 タグ辞書（カテゴリ別）

```jsonc
// data/tags.json  （自動生成物）
{
  "role": [
    { "id": "attacker", "ja": "アタッカー", "zh-Hans": "输出", "zh-Hant": "輸出" },
    { "id": "balancer", "ja": "バランサー", "zh-Hans": "均衡", "zh-Hant": "均衡" },
    { "id": "supporter", "ja": "サポーター", "zh-Hans": "辅助", "zh-Hant": "輔助" }
  ],
  "style": [
    { "id": "collector", "ja": "収集家", "zh-Hans": "收集者", "zh-Hant": "收集者" },
    { "id": "steady", "ja": "しっかり者", "zh-Hans": "稳重", "zh-Hant": "穩重" }
  ]
}
```

> 追加言語キーは任意。存在しない場合は Fallback する。

### 2.2 巡游者/依頼

- **巡游者**：

```jsonc
{
  "id": "kohaku",
  "name": { "ja": "コハク", "zh-Hans": "琥珀", "zh-Hant": "琥珀" },
  "icon": "assets/characters/kohaku.png",
  "tags": { "role": ["attacker"], "style": ["collector"], "faction": ["blank"] }
}
```

- **依頼**（ミッション名・報酬名なども辞書）：

```jsonc
{
  "id": "m001",
  "name": { "ja": "旧遺跡の調査", "zh-Hans": "旧遗迹调查" },
  "requiredLevel": 50,
  "baseConditions": [ { "category": "style", "anyOf": ["collector"] } ],
  "bonusConditions": [ { "category": "role", "anyOf": ["attacker"] } ],
  "rewards": [ { "type": "gold", "amount": 12000, "label": { "ja": "ゴールド", "zh-Hans": "金币" } } ]
}
```

---

## 3. 編集元（人手が触るファイル）

### 3.1 タグ（日本語が唯一の正）

```json
// data/tags.src.json  ★編集対象
{
  "role": ["アタッカー", "バランサー", "サポーター"],
  "style": ["収集家", "しっかり者"],
  "faction": ["空白旅団", "ウィンドアッシュ"]
}
```

- スラッグ（id）は自動生成。
- **中国語訳は **``** / **``** に追加**（任意。無ければ日本語にフォールバック）。

### 3.2 巡游者・依頼（CSV）

- 日本語列を必須、必要に応じて中国語列を追加。
- 例：`characters.csv`

```
id,name_ja,name_zh-Hans,name_zh-Hant,role,style,faction,element,rarity
kohaku,コハク,琥珀,琥珀,アタッカー,収集家,空白旅団,水,5
```

- 例：`missions.csv`

```
id,name_ja,name_zh-Hans,requiredLevel,base(style),bonus(role),rewards
m001,旧遺跡の調査,旧遗迹调查,50,収集家,アタッカー,gold:12000
```

---

## 4. 変換スクリプト拡張（scripts/csv-to-json.ts）

- ステップ：
  1. `tags.src.json` を読み込み → **スラッグ化**→ `tags.json` を構築。
  2. `i18n/tags.*.json` をマージして各エントリに `zh-Hans`/`zh-Hant` フィールドを付与（存在すれば）。
  3. `characters.csv`/`missions.csv` を読み込み：
     - 表示名は `{ ja, zh-Hans?, zh-Hant? }` へ格納。
     - タグ参照は **日本語→ID** へ辞書引きして正規化（不一致はCIでエラー）。

### 4.1 i18n ファイルの例

```json
// i18n/tags.zh-Hans.json
{
  "role": { "アタッカー": "输出", "バランサー": "均衡", "サポーター": "辅助" },
  "style": { "収集家": "收集者", "しっかり者": "稳重" }
}
```

> キーは **日本語ラベル**、値が翻訳。変換時に `tags.json` の `id` に突き刺す。

---

## 5. UI 仕様（言語切替）

- ヘッダーに **言語セレクタ**（`日本語 / 简体中文 / 繁體中文`）。
- 選択状態は `localStorage: ss-lang` に保存。初回は `navigator.language` で初期化（`zh-CN→zh-Hans`, `zh-TW→zh-Hant` など）。
- `t(key)` ヘルパで取得：

```ts
// 例：タグ表示
tagLabel = entry[lang] ?? entry.ja ?? entry.id;
```

---

## 6. テスト/CI

- JSON スキーマに `patternProperties: { "(ja|zh-Hans|zh-Hant)": { type: "string" } }` を追加。
- `i18n` のキー（日本語）が `tags.src.json` に存在するかをチェック。
- 未訳カバレッジの集計を CI 出力（%表示）。

---

## 7. 文字/表示上の注意

- Web フォントは Noto 系（JP/SC/TC）を優先指定。言語に応じて `font-family` を切替。
- 文字幅差によるUI崩れに備え、チップやボタンは **自動折返し** と **min/max 幅**を指定。
- ソート・検索は**表示文言**ではなく **ID** ベースで行う（多言語で結果が安定）。

---

## 8. 既存設計との互換性

- 既存の ID/ビットマスク/組合せ探索は**変更不要**。
- 追加は辞書読取と UI レイヤのみ。後方互換性あり。

---

## 9. 導入フロー（短縮版）

1. `i18n/` ディレクトリを追加：`tags.zh-Hans.json`, `tags.zh-Hant.json`（空でも可）。
2. CSV に `name_zh-Hans` / `name_zh-Hant` 列を追加（任意）。
3. `npm run build:data` → 生成物に多言語フィールドが付与。
4. UI に言語セレクタを追加し、`t()` ヘルパを適用。

---

これで、中国語（簡体/繁体）の追加が容易に行えます。翻訳は段階的に追記しても動作し、未訳箇所は日本語にフォールバックします。

